<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="CSharp,Async,CheatSheet," />





  <link rel="alternate" href="/atom.xml" title="NerdCats Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Tip: Dont go for Async VoidYou get possibly three return types for async methods and those would be 

Task
Task &amp;lt; T &amp;gt;
void     

Its always better if you can avoid the void  
Reason:Async Void m">
<meta property="og:type" content="article">
<meta property="og:title" content="Asynchrnous Programming in C# Cheat Sheet">
<meta property="og:url" content="http://nerdcats.github.io/2016/07/18/csharpasyncprogcheatsheet/index.html">
<meta property="og:site_name" content="NerdCats Blog">
<meta property="og:description" content="Tip: Dont go for Async VoidYou get possibly three return types for async methods and those would be 

Task
Task &amp;lt; T &amp;gt;
void     

Its always better if you can avoid the void  
Reason:Async Void m">
<meta property="og:updated_time" content="2016-07-18T19:53:34.123Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Asynchrnous Programming in C# Cheat Sheet">
<meta name="twitter:description" content="Tip: Dont go for Async VoidYou get possibly three return types for async methods and those would be 

Task
Task &amp;lt; T &amp;gt;
void     

Its always better if you can avoid the void  
Reason:Async Void m">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://nerdcats.github.io/2016/07/18/csharpasyncprogcheatsheet/"/>

  <title> Asynchrnous Programming in C# Cheat Sheet | NerdCats Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">NerdCats Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Random tech ramblings no one basically cares about</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Asynchrnous Programming in C# Cheat Sheet
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-18T19:19:18+02:00" content="18-07-2016">
              18-07-2016
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Tip-Dont-go-for-Async-Void"><a href="#Tip-Dont-go-for-Async-Void" class="headerlink" title="Tip: Dont go for Async Void"></a>Tip: Dont go for Async Void</h3><p>You get possibly three return types for async methods and those would be </p>
<ul>
<li>Task</li>
<li>Task &lt; T &gt;</li>
<li>void     </li>
</ul>
<p>Its always better if you can avoid the void  </p>
<h4 id="Reason"><a href="#Reason" class="headerlink" title="Reason:"></a>Reason:</h4><p>Async Void methods were made possible so one can have async event handlers. Exceptions thrown out of these are actually handled in the Synchronization context that was active at that time, meaning you wont be able to &quot;catch&quot; it with a &quot;catch&quot;. 
You can definitely catch those in App.UnhandledException or similiar all unhandled exception catching scenarios. Plus, its not testable too.  </p>
<p>If you go for returning Task you will see your async methods are returning a Task object which essentially has the exceptions noted inside of it.</p>
<h4 id="Workaround"><a href="#Workaround" class="headerlink" title="Workaround:"></a>Workaround:</h4><p>In case of stuff like async event handlers, the best thing to do would be is to put the actual code logic in a separate awaited method so you can test it whenever you want.</p>
<h3 id="Tip-Once-Async-always-go-async"><a href="#Tip-Once-Async-always-go-async" class="headerlink" title="Tip: Once Async always go async"></a>Tip: Once Async always go async</h3><p>Async codes are written better if they are written from the top to the bottom in an all async paradigm, meaning its always better to wrap an async method 
in another async method all the way to the bottom. If you wrap up a little async code in your sync code context, you might end up in a deadlock.</p>
<h4 id="Reason-and-Example"><a href="#Reason-and-Example" class="headerlink" title="Reason and Example:"></a>Reason and Example:</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">DeadlockDemo</span></div><div class="line">&#123;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">DelayAsync</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// This method causes a deadlock when called in a GUI or ASP.NET context.</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Test</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">    <span class="comment">// Start the delay.</span></div><div class="line">    <span class="keyword">var</span> delayTask = DelayAsync();</div><div class="line">    <span class="comment">// Wait for the delay to complete.</span></div><div class="line">    delayTask.Wait();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This piece of code would end up in a deadlock in GUI or ASP.net apps. Because when you await a Task the current context is captured so it can be resumed 
on the current context after the awaiting is done. The context is usually the current SynchronizationContext which is essentially the TaskScheduler. In Asp.net 
or GUI app youre only supposed to run a single chunk of code at a time. In this case the DelayAsync await is completed it is trying to complete the rest 
of the code after await in the captured context. This context has already a thread in it and waiting for the async call to be finished. They are waiting on 
each other = deadlock.</p>
<p>In case of a console app, this would execute just fine. Because it has a thread pool SynchronizationContext so it would execute the rest of the async method 
in a separate thread.</p>
<blockquote>
<p>A good thing to remember here is that if you await a async method only the first exception occured would be rethrown. If you block in synchronously you&#39;d get 
an AggregateException with all the exceptions in it</p>
</blockquote>
<h3 id="Tip-Configuring-await-context"><a href="#Tip-Configuring-await-context" class="headerlink" title="Tip: Configuring await context"></a>Tip: Configuring await context</h3><p>When you have a lot of incy wincy bits of async code, your GUI app might end up in a situation where most of the time its busy handling those async events. 
This can lead to performance issues.</p>
<h4 id="Solution-and-Example"><a href="#Solution-and-Example" class="headerlink" title="Solution and Example:"></a>Solution and Example:</h4><p>Using ConfigureAwait at the end of your async call might help you in this case. Follow the following example:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">MyMethodAsync</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">  <span class="comment">// Code here runs in the original context.</span></div><div class="line">  <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</div><div class="line">  <span class="comment">// Code here runs in the original context.</span></div><div class="line">  <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>).ConfigureAwait(</div><div class="line">    continueOnCapturedContext: <span class="literal">false</span>);</div><div class="line">  <span class="comment">// Code here runs without the original</span></div><div class="line">  <span class="comment">// context (in this case, on the thread pool).</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You can definitely see here that we are denying to run the rest of the async method after the await in the same context. Now it would use a thread pool synchrnizing context for your code and esssentially would make your code deadlock free and a tad smoother. Very handy for UWP app people. </p>
<h4 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h4><p>For GUI people, dont use ConfigureAwait everywhere! Please only use it when the rest of the code doesnt handle any GUI events (databound update, GUI updates) and for 
ASP.net people, dont use it if the rest of the code uses HttpContext of that time. </p>
<p>And finally, If you&#39;re not a TLDR; guy and need more please read <a href="https://msdn.microsoft.com/en-us/magazine/jj991977.aspx" target="_blank" rel="external">this</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CSharp/" rel="tag">#CSharp</a>
          
            <a href="/tags/Async/" rel="tag">#Async</a>
          
            <a href="/tags/CheatSheet/" rel="tag">#CheatSheet</a>
          
        </div>
      

      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/nerdcats_avatar.png"
               alt="NerdCats" />
          <p class="site-author-name" itemprop="name">NerdCats</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/NerdCats" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github-alt"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/nerdcats" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tip-Dont-go-for-Async-Void"><span class="nav-text">Tip: Dont go for Async Void</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Reason"><span class="nav-text">Reason:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Workaround"><span class="nav-text">Workaround:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tip-Once-Async-always-go-async"><span class="nav-text">Tip: Once Async always go async</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Reason-and-Example"><span class="nav-text">Reason and Example:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tip-Configuring-await-context"><span class="nav-text">Tip: Configuring await context</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Solution-and-Example"><span class="nav-text">Solution and Example:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Warning"><span class="nav-text">Warning</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NerdCats</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
